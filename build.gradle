plugins {
    id 'com.moowork.node' version '1.3.1'
}

node {
    version = '13.0.0'
    npmVersion = '6.12.0'
    download = false
    workDir = file("${project.buildDir}/nodejs")
    npmWorkDir = file("${project.buildDir}/npm")
    nodeModulesDir = file("${project.projectDir}")
}

task ngBuild(type: Exec) {
    workingDir rootProject.projectDir
    commandLine 'ng', 'build', '--prod', '--build-optimizer'
}

task clean(type: Delete) {
    delete "${projectDir}/dist"
}

task cleanAll(type: Delete) {
    delete project.buildDir, "${projectDir}/node_modules"
}

task buildDockerImage(type: Exec) {
	workingDir rootProject.projectDir
	commandLine 'docker', 'build', '-t', 'ac-fix/ac-fix-client:1.0', '.'
}

cleanAll.dependsOn clean
ngBuild.dependsOn npm_install
buildDockerImage.dependsOn ngBuild
